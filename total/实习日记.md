# 实习日记

## 第二天

如何快速查看接口

复制接口path:

如:前端调用了接口'../find-ali-pay-mccPage',复制字符串在eclipse中搜索:按Ctrl+H查找。要查找文件中的方法所在的位置可以 按住Ctrl,然后鼠标光标移动到方法字符串上,最后选择 Open Implementation选项。

api接口所在位置:fusion-front-manager-project/fusion-front-manager-controller/src/main/java/com..../controller/baseInfo/BizCategoryController.java

文件中的代码内容如下:

``` java
package com.baoming;

import fileName;

@RestController
@RequestMapping("/category")
public class BizCategorycontroller extends BaseManagerFrontController{
    //资源文件
    @Resource
    private BizCategoryService iBizCategoryService;

    //子post路径
    @PostMapping("/find-ali-pay-mccPage")
    public RspVo findAliPayMccPage(@RequestBody @Valid FindAliPayMccListReqVoEx req) throws Exception {
        return this.iBizCategoryService.findAliPayMccPage(req);
    }
}
```

BaseManagerFrontController.java文件代码

``` java
package com.baoming;

import fileName;

@Service
public class BaseManagerFrontController extends BaseFrontController{
    @SuppressWarnings("unchecked")
    protected <T> T retrieveSession(SessionKey sessionKey){
        String sid = this.extractPolySid();
        //this.logger.info("BaseManagerFrontController用户登录Sid[{}]",sid);
        SessionModel sessionModel = RedisHelper.get(BaseFrontController.SESSION_ATTR_NAME+sid,SessionModel.class);
        Object ret = null;
        switch(sessionKey){
            case OPEC_ACC:
                ret = sessionModel.getOperAcc();
                break;
        }
        if(ret == null){
            throw new RuntimeException("retrieveSession error:" + sessionKey);
        }
        return (T) ret;
    }

    protected String extractPolySid(){
        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttriutes()).getRequest();
        String Sid = request.getHeader(BaseFrontController.SESSION_ID);
        this.logger.debug("Sid:[{}]",Sid);
        return Sid;
    }

    protected static final Map<String,SessionModel>SESSION_DUMMP = new ConcurrentHashMap<>();

    public enum SessionKey{
        OPEC_ACC
    }
}
```

RspVo.java文件代码

``` java
package com.baoming;

import java.io.Serializable;

public class RspVo implements Serializable{
    private static final long serialVersionUID = -3217121193700095047L;
    private final boolean success;
    private Object data;

    public RspVo(boolean success,Object data){
        this.success = success;
        this.data = data;
    }

    /**
     * 信息返回内容
     * {"data":{"result":"事件查询失败","returnCode":99022},"success":false}
     */
    public RspVo(boolean success,int returnCode,Object data){
        this.success = success;
        Result result = new Result(returnCode,data);
        this.data = result;
    }

    public boolean isSuccess(){
        return success;
    }

    public Object getData(){
        return data;
    }

    public void setData(Object data){
        if(data == null){
            this.data = "";
        }
        this.data = data;
    }
}

class Result{
    private int returnCode;
    private Object result;
    public int getReturnCode(){
        return returnCode;
    }

    public void setReturnCode(int returnCode){
        this.returnCode = returnCode;
    }

    public Object getResult(Object result){
        return result;
    }

    public void setResult(Object result){
        this.result = result;
    }

    public Result(){
        super();
    }

    public Result(int returnCode,Object result){
        super();
        this.returnCode = returnCode;
        this.result = result;
    }
}
```

FindAliPayMccListReqVoEx.java文件代码

``` java
package com.baoming;

import com.filename;

public class FindAliPayMccListReqVoEx extends EasyUiDatagridPageQuery{
    private String manageCategoryCode;  //经营类目编码
    private String manageCategoryName;  //经营类目代码
    private String manageCategoryLev;   //级别

    private String manageCategoryType;  //类型

    //get set方法
    //...

    @Override
    public String toString(){}
}
```

EasyUiDatagridPageQuery.java文件代码

``` java
package com.baoming;

public class EasyUiDatagridPageQuery{
    private int page;   //页码数

    private int rows;   //每页记录数

    //get set方法
    //...

    /**
     * 计算微服务 分页查询条件之中的偏移量参数
     * @return 偏移量
     */
    public int calcOffset(){
        return this.page;
    }
}
```

BizCategoryService.java文件代码

``` java
package com.baoming;

import fileName;

@Service
public class BizCategoryService extends BaseManagerFontController{
    /**
     * 微服务接口
     */
    @Reference(version = "1.0.0")
    private IManageCategoryService manageCateService;

    @Reference(version = "1.0.0")
    private IComonService icommonService;
    //操作轨迹
    @Reference(version = "1.0.0")
    private IAuditService iAuditService;

    /**
     * 查询支付宝经营类目
     * @param req
     * @return
     * @throws Exception
     */
    public RspVo findAliPayMccPage(FindAliPayMccListReqVoEx req) throws Exception{

        FindAliPayMccListReqVo vo = new FindAliPayMccListReqVo();
        BeanUtils.copyProperties(req,vo);
        //根据参数值组装 微服务 接口所用的查询参数

        Page<FindAliPayMccListReqVo> param = new Page<>(req.calcOffset(),req.getRows(),vo);

        PageableResult<FindAliPayMccPageResVo> ret = this.icommonService.findAliPayMccPage(param);
        this.logger.info("=======>查询支付宝经营类目[{}]",ret.getReturnMsg());
        //根据微服务 接口返回值组装响应对象
        EasyUiDatagridResult result = new EasyUiDatagridResult();
        result.setTotal(ret.getTotal());
        result.setRows(ret.getData());
        return new RspVo(true,result);
    }
}
```

ICommonService.java文件代码

``` java
package com.baoming;

import fileName;

/**
 * 商户公共服务
 */
public interface ICommonService{
    /**
     * 分页查询支付宝经营类目
     * @param findAreaInfoListReqVo
     * return
     */
    public PageableResult<FindAliPayMccPageResVo> findAliPayMccPage(Page<FindAliPayMccListReqVo> findAreaInfoListReqVo);
}
```

FindAliPayMccPageResVo.java文件代码

``` java
public class FindAliPayMccPageResVo implements Serializable{
    private static final long serialVersionUID = -2137450591211144915L;
    private String manageCategoryCode; //经营类目编码
    private String manageCategoryName;  //经营类目名称
    private String manageCategoryStatus;    //状态 0:正常 1:禁用
    private String createTime;  //创建时间
    private String createOper;  //添加操作员
    private String updateTime;  //修改时间
    private String updateOper;  //更新操作员

    private String manageCategoryLev;   //经营类目级别 1: 一级类目 2:二级类目 3:三级类目

    private String cate
}
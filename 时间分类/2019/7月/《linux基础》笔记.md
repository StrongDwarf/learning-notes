# 《linux基础》笔记

###### author:朱泽聪
###### createTime:2019/7/13

## 目录

* [linux操作系统概述](1,linux操作系统概述)
* [文件和目录管理命令](2,文件和目录管理命令)
* [编辑器概述](3,编辑器概述)
* [基础应用和软件管理](4,基础应用和软件管理)
* [权限管理和目录应用](5,权限管理和目录应用)

## 1,linux操作系统概述

### 1.1 linux操作系统启动流程梳理

linux系统启动流程可以简单总结为以下几步:

**开机BIOS自检** -> **可启动设备检查** -> **执行引导程序启动设备** -> **加载内核** -> **启动初始化进程** -> **启动内核模块** -> **进入系统登录界面**

* 开机BIOS自检 : 基本输入输出系统完成, 硬件检查, 可启动设备检查, 最终完成加载硬盘。
* 可启动设备检查 : 读取可启动设备, 让主引导记录进行可启动设备引导。
* 执行引导程序启动设备 : 通过grub引导菜单, 执行引导程序GRUB, 此菜单可以作为几乎所有操作系统的引导程序, 相关文件保存在/boot/grub内。
* 加载内核kernel : 执行init -> 调用 /etc/rc.d/rc.sysinit 对系统进行初始化。最终挂载文件系统, 并管理进程的启动程序。
* 启动初始化进程 : 根据inittab文件设定运行级别。 init文件,执行rc.sysinit文件。
* 启动内核模块 : 执行不同级别的脚本程序。
* 执行/etc/rc.d/rc.local。
* 进入系统登录界面。

###### 初始化进程介绍

对于初始化进程, 内核文件加载以后, 就开始运行第一个程序 /sbin/init。 它的作用是初始化系统环境。

由于init是第一个运行的程序, 它的进程编号 (pid) 就是1。其他所有进程都从它衍生, 都是它的子进程。

###### linux中运行级别介绍

linux允许为不同的场合, 分配不同的开机启动程序, 这就叫做"运行界别" (runlevel)。 启动时根据"运行级别", 确定要启动哪些程序。

linux预置七种运行级别 (0-6):

* 0 : 关机模式。
* 1 : 单用户模式。(破解root密码的方法需要用到此模式)
* 2 : 无网络支持的多用户模式。
* 3 : 有网络支持的多用户模式。(即文本模式)
* 4 : 保留, 未使用。
* 5 : 有网络支持的X-windows支持多用户模式。 (即桌面图形模式)
* 6 : 重新引导系统, 即重启。 (相当于reboot)

对于加载开机启动程序, 七种预设的"运行级别"各自有一个目录, 存放需要开机启动的程序。

不难想到, 如果多个"运行级别"需要启动同一个程序, 那么这个程序的启动脚本, 就会在每一个目录里都有一个拷贝。 七种模式对就 /etc/rc[N].d 目录里列出的程序, 都设为链接文件, 指向另外一个目录 /etc/init.d, 真正的启动脚本都统一放在这个目录中。

init脚本逐一加载开机启动程序, 其实就是运行这个目录里的启动程序。

###### 系统登录的几种情况

一般来说, 用户的登录方式有三种: 命令行登录, ssh登录, 图像界面登录。 这三种情况, 都有自己的方式对用户进行认证。

* **命令行登录 :** init进程调用getty程序 (意为get teletype) , 让用户输入用户名和密码, 输入完成后, 再调用login程序, 核对密码。 如果密码正确, 就从文件 /etc/passwd 读取用户指定的shell, 然后启动这个shell。
* **ssh登录 :** 这时系统调用sshd程序 (Debian还会再运行 /etc/pam.d/ssh ) , 取代getty和login, 然后启动shell。
* **图像界面登录 :** init进程调用显示管理器, Gnome图形界面对应的显示管理器为gdm, 然后用户输入用户名和密码。 如果密码正确, 就读取/etc/gdb3/Xsession, 启动用户的会话。

### 1.2 linux操作系统内核概述

linux的内核版本有两种 : 稳固版和开发版。

linux内核版本号是由3个数字构成 : a.b.c

* a : 主版本号, 目前发布的内核主版本。
* b : 次版本号, 偶数表示稳固版本, 奇数表示开发中版本。
* c : 修订版本号, 错误修补的次数。

### 1.3 linux操作系统内核查看

查看系统内核命令:

* uname -a
* file /bin/ls
* cat /proc/version
* getconf LONG_BIT

值得注意的是只有标识**x86_64**的才是**64**位操作系统。

## 2,文件和目录管理命令

linux命令 : 用于实现某一类功能的指令或程序, 命令的执行依赖于解释器程序(例如: /bin/bash)

linux命令的分类:

* 内部命令 : 在系统启动时就掉入内存, 是常驻内存的, 所以执行效率高, 属于shell解释器的一部分。
* 外部命令 : 系统的软件功能, 用户需要时才从硬盘中读入内存, 独立于shell解释器之外的程序文件。

### 2.1 命令行编辑辅助

命令行编辑的几个辅助操作

* Tab键 : 自动补全
* 反斜杠"\" : 强制换行
* 快捷键 Ctrl + u : 清空至行首
* 快捷键 Ctrl + l : 清屏
* 快捷键 Ctrl + c : 取消本次命令编辑
* 快捷键 Ctrl + a : 光标移至行首
* 快捷键 Ctrl + e : 光标移至行尾

### 2.2 管道和重定向

**管道符命令格式 :** 命令A|命令B, 即命令A的正确输出作为命令B的操作对象。

**输出重定向** :

* > : 代表以覆盖的方式将命令的正确输出输出到指定的文件或设备当中。
* >> : 代表以追加方式输出。
* 常用的输出重定向:
  * 命令 >> 文件 2>&1 : 以追加的方式, 把正确输出和错误输出都保存在文件中。
  * 命令 &> 文件名 : 以覆盖的方式将正确和错误输出都保存在文件中。
  * 命令 &>> 文件名 : 以追加的方式将正确和错误输出都保存在文件中。
  * 命令 1>> 文件A 2>> 文件B : 正确的输出到A文件中, 错误的输出到B文件中。

### 2.3 文件和目录管理

###### 操作系统文件的分类

* **文件数据区分** :
  * 源文件 : 应用程序加载的文件。
  * 目标文件 : 被应用程序输出的文件。
* **逻辑结构区分** :
  * 流式文件 : 构成流式文件的基本单位是字符或字节, 如ASCII码文件或二进制文件。
  * 记录文件 : 构成记录文件的基本单位是记录, 一条记录又由若干个数据项构成。
* **使用途径区分** :
  * 系统文件 : 由系统软件构成的文件, 包括操作系统内核, 编译程序等二进制文件。
  * 用户文件 : 用户自己定义的文件, 如用户的源程序, 可执行程序, 文档等。
  * 库文件 : 由标准的和非标准的子程序库构成的文件。
* **个体性质区分** :
  * 特殊文件 : 输入/输出设备被看做特殊的文件, 主要包括块设备文件和字符设备文件。
  * 目录文件 : 包含普通文件与目录文件的属性信息的特殊文件。
  * 文本文件 : 文本系统所规定的普通格式, 使用指定字符集编辑完成的文件。
  * 数据文件 : 被加密, 压缩, 编译, 封装的文件。
* **保护级别区分** :
  * 只读文件 : 只能查询不能被编辑和执行内容的文件。
  * 只写文件 : 只能被编辑不能被查询和执行内容的文件。
  * 可读写文件 : 能被查询并能编辑但不能执行内容的文件。
  * 可执行文件 : 不允许查询和编辑, 仅提供执行内容的文件。
  * 不限制文件 : 能被查询, 编辑, 执行内容的文件。
* **保存期限区分** :
  * 临时文件 : 只能被查询不能被编辑和执行内容的文件。
  * 永久文件 : 只能被编辑不能被查询和执行内容的文件。

###### 文件和目录操作命令

* **目录操作命令** :
  * pwd : 查看当前所在目录。
  * cd : 切换工作目录。
  * ls : 列表显示目录内容。
  * mkdir : 创建新的目录。
    * -p : 选项用于创建多级目录。
  * du : 统计目录及文件的空间占用情况。
    * -h : 以更易读的字节单位显示信息。
    * -s : 只统计每个参数所占用空间总的大小。
* **文件操作命令** :
  * touch : 新建空文件, 或更新文件时间标记。
  * file : 查看文件类型。
  * cp : 复制文件或目录。
    * 格式 : cp <选项> <源文件或目录参数> <目标文件或目录参数>
    * -r : 递归复制正个目录树
    * -p : 保持源文件的属性不变
    * -f : 强制覆盖目标同名文件或目录
    * -i : 需要覆盖文件或目录时进行提醒
    * -a : 维持所有功能特性进行拷贝
  * rm : 删除文件或目录
    * -f : 强行删除文件或目录, 不进行提醒
    * -r : 递归删除整个目录树
  * mv : 移动文件或目录
    * 格式 : mv <选项> <源文件或目录参数> <目标文件或目录参数>
  * which : 查找Linux命令文件并显示所在的位置
  * find : 用于查找文件或目录
    * 格式 : find <查找范围参数> <选项> <查找内容参数>
    * -name : 按文件名称查找
    * -size : 按文件大小查找
    * -user : 按文件属主查找
    * -type : 按文件类型查找
  * xargs :
  * ln : 为文件或目录简历链接(link)
    * -s : 建立符号链接文件 (省略此项则建立硬链接)
    * 符号链接 : 指向原始文件所在的路径, 又称为软链接
    * 硬链接 : 指向原始文件对应的数据存储位置
    * 不能为目录建立硬链接文件
    * 硬链接与原始文件必须位于同一分区(文件系统)中
* **文件内容操作命令** :
  * echo : 输出字符内容
    * -n : 不换行输出
    * -e : 输出转义字符
  * cat : 显示出文件的全部内容
  * more : 全屏方式分页显示文件内容
    * 交互方式 : 按Enter键向下逐行滚动, 按空格键向下翻一屏, 按b键向上翻一屏, 按q键退出。
  * less : 与more命令相同, 但扩展功能更多。
  * head : 查看文件开头的一部分内容, 默认为10行
    * 格式 : head [行数] <参数>
  * tail : 查看文件结尾的少部分内容, 默认为10行
  * wc : 统计文件中的单词数量等信息
  * grep : 单词匹配
* **归档及压缩命令**
  * tar : 制作归档文件, 释放归档文件
    * -c : 创建 .tar 格式的包文件
    * -x : 解开 .tar 格式的文件
    * -v : 输出详细信息
    * -f : 表示使用归档文件
    * -p : 打包时保留原始文件及目录的权限
    * -t : 列表查看包内的文件
    * -c : 解包时指定释放的目标文件夹
    * -z : 调用gzip程序进行压缩或解压
    * -j : 调用bzip2程序进行压缩或解压

``` bash
# du : 统计文件及目录的控件占用情况
[@xiaobaicai test]$ du -sh xiaobaicai.txt
4.0K xiaobaicai.txt

# touch : 新建空文件
[@xiaobaicai test]$ ls
a b c
[@xiaobaicai test]$ touch xiaobaicai.txt
[@xiaobaicai test]$ ls
a b c xiaobaicai.txt
# cp : 复制文件或目录
[@xiaobaicai test]$ cp ./xiaobaicai.txt ./a/temp.txt
[@xiaobaicai test]$ ls ./a
temp.txt
# rm : 删除指定文件夹或文件
[@xiaobaicai test]$ rm ./a/temp.txt
[@xiaobaicai test]$ ls ./a
# 无显示

# find : 用于查找文件或目录
# 创建文件 略
[@xiaobaicai test]$ ls ./a
xiaobaicai xiaobaicai.txt aaa abc.txt a.sh
[@xiaobaicai test]$ find ./a -name "*.sh"
./a/a.sh
[@xiaobaicai test]$ find -name "*xiaoba*"
./a/xiaobaicai
./a/xiaobaicai.txt
```

### 2.4 VI编辑器

* 进入vi编辑器 : vi [文件行号] <文件名>
* 编辑 : 按 i, o, a等字符进入输入模式
* 进入末行输入模式 : 在编辑状态按esc退出编辑模式并进入末行输入模式
* 退出 :
  * :q : 未修改退出
  * :w : 保存文件
  * :wq : 保存文件并退出
  * :w <文件地址> : 另存为其他文件

### 2.5 正则表达式规则

**正则表达式规则** :

* ^ : ^word 搜索以word开头的内容
* $ : word$ 搜索以word结尾的内容
* ^$ : 表示空行, 不是空格
* . : 代表且只能代表任意一个字符 (不匹配空行)
* \ : 转移字符
* * : 重复之前的字符或文本0个或多个, 之前的文本或字符0次或多次
* [abc][0-9][\.,/] : 匹配字符集合内的任意一个字符a或b或c, 匹配0-9中的任意一个字符
* [^abc] : 匹配不包含abc中任意一个字符的任意字符
* a\{n,m\} : 重复前面a字符n到m次
* a\{n,\} : 重复前面a字符至少n次
* a\{n\} : 重复a n次
* + : 重复前一个字符一次或一次以上
* ? : 重复前面的字符0次或1次
* | : 表示或者同时过滤多个字符
* () : 分组过滤被括起来的东西表示一个整体(一个字符), 反向引用

### 2.6 文件搜索命令

* **grep** : 在文件中查找并显示包含指定字符串的行
  * -i : 查找时忽略大小写
  * -v : 反向查找, 输出与查找条件不相符的行
* **egrep** : 在文件中查找并显示包含指定字符串的行, 使用扩展正则表达式来构建模式, 相当于grep -E
* **fgrep** : 在文件中查找并显示包含指定字符串的行, 但它不解析正则表达式
* **sed** : sed是一个很好的文件处理工具, 本身是一个管道命令, 主要是以行为单位进行处理, 可以将数据行进行替换, 删除, 新增, 选取等特定工作。
  * -n : 使用安静模式。只有经过sed特殊处理的哪一行才会被列出来
  * -i : 直接修改读取的档案内容, 而不是有银屏输出。

### 2.7 awk命令

**用途** : awk语言的最基本功能是在文件或字符串中基于指定规则浏览和抽取信息, awk抽取信息后, 才能进行其他文本操作。

**格式** : wak [选项] '{pattern + action}' <文件参数>

**其中** :

* commands是真正awk命令, 文件参数是待处理的文件。 在awk中, 文件的每一行中, 由域分隔符分开的每一项称为一个域。
* 在不指明-F分隔域的情况下, 默认的域分隔符是空格。

**awk工作流程** : 读入有 '\n' 换行符分割的一条记录, 然后将记录按指定的域分隔符划分域, 填充域, $0表示所有域, $1 表示第一个域, $n表示第n个域。默认域分隔符是"空白键" 或 "[tab]键"。

``` bash
# awk使用示例
[@xiaobaicai test]$ ls
xiaobaicai.txt
[@xiaobaicai test]$ cat xiaobaicai.txt
1 a
2 b
3 c
4 d
[@xiaobaicai test]$ cat xiaobaicai.txt | awk '{print $1}'
1
2
3
4
```

## 2,基础用户和软件管理

**用户账号的管理工作主要涉及到用户账号的添加,修改和删除** :

添加用户账号就是在系统中创建一个新账号, 然后为新账号分配用户号, 用户组, 主目录和登录shell等资源。刚添加的账号是被锁定的, 无法使用。

**查看本地用户账户的用户名**

``` bash
# id
uid=0(root) gid=0(root) groups=0(root)
```

### 系统用户管理

* **创建新用户** :
  * 命令 : useradd <选项> <参数>
  * -c : comment指定一段注释性描述
  * -d : 目录, 指定用户主目录, 如果此目录不存在, 则同时使用-m选项, 可以创建主目录
  * -g : 指定用户所属主的用户组
  * -G : 用户组, 用户组指定用户所属的附加组
  * -s : Shell文件, 指定用户的登录Shell
  * -u : 用户号 指定用户的用户号, 如果同时有-o选项,则可以重复使用其他用户的标识号。
* **删除用户** :
  * 命令 : userdel <选项> <参数>
  * -r : 把用户的主目录一起删除
* **修改账号** :
  * 命令 : usermod <选项> <参数>
* **用户口令管理** :
  * 命令 : passwd <选项> <参数>
  * 普通用户只能修改自己的口令, 超级用户可以为自己和其他用户指定口令。
  * -l : 锁定口令
  * -u : 口令解锁
  * -d : 使账号无口令
  * -f : 强迫用户下次登录时修改口令

``` bash
# 创建新用户, 并为其指定主空间和所属用户组
[@root home]$ useradd -c 'user for xiaobaicai' -d ./home/user/xiaobaicai -g group1 xiaobaicai

# 删除用户, 并删除其主目录
[@root home]$ userdel -r xiaobaicai

# 修改用户主目录
[@root home]$ usermod -d ./home/user/xiaobaicai1 xiaobaicai
```

### 系统用户组管理

* **新增用户组** :
  * 命令 : groupadd <选项> <参数>
  * -g : GID指定新用户组的组标识号
  * -o : 一般与-g选项同时使用, 标识新用户组的GID可以与系统已有用户组的GID相同
* **删除用户组** :
  * 命令 : groupdel 用户组
* **修改用户组** :
  * 命令 : groupmod <选项> <参数>
  * -g : GID为用户组指定新的组标识号
  * -o : 与-g选项同时使用, 用户组的新GID可以与系统已有用户组的GID相同
  * -n : 将用户组的名字该为新名字
  * 

``` bash
# 新建一个用户组
[@root home]$ groupadd -g 1001 group2

# 删除一个用户组
[@root home]$ groupdel group2

# 修改用户组标识号和名称
[@root home]$ groupmod -g 1002 -n group3 group2
```

### 用户切换

**命令 : su - <username>**

* 由普通用户切换到root用户时需要输入密码
* 由root用户切换到普通用户时不需要输入密码
* 如果仅仅只要切换到root进行一次操作, 可以使用 su -c 命令

### SSH登录

**命令 : ssh 用户名@IP地址**

* 不允许空密码或错误密码认证登录
* 不允许root用户登录
* 有两个版本ssh, ssh2安全性更高
* 查看外部ssh连接本地情况 : w -f

### SCP命令

* 作用 : 两节点文件的拷贝传输
* 命令 : scp 路径/文件名 用户名@IP地址:目录
* -p : 文件属性不发生变化
* -r : 如果拷贝的是目录 需要加上-r 递归

### sftp命令

``` bash
# sftp下载文件
# 进入sftp
[@root ~]$ sftp serverX
@root‘s password : pass
Connected to serverX
# 下载文件
sftp> get /etc/you.conf
# 上传文件
sftp> mkdir hostbackup
sftp> cd hostbackup
sftp> put /etc/hosts
```

### systemd概述

系统启动和服务器进程由systemd系统和服务管理器管理。

这个程序提供了一种方法来激活系统资源, 服务器守护进程和其他进程, 无论是在启动时还是在运行中的系统上。

相关命令:

* 启动一个服务 : systemct| start sshd.service
* 关闭一个服务 : systemct| stop sshd.service
* 重启一个服务 : systemct| restart sshd.service
* 显示一个服务的状态 : systemct| status sshd.service
* 在开机时启动一个服务 : systemct| enable sshd.service
* 在开机时禁用一个服务 : systemct| disable sshd.service
* 查看服务是否开机启动 : systemct| is-enabled sshd.service:echo $?
* 查看已启动的服务列表 : systemct| list-unit-files|grep enabled

### 网络性能

* 查询网卡接口 : ip add show
* 显示网络接口性能 : ip -s link show
* 查看路由表 : route -n
* 测试网络连通性 : ping www.baidu.com
* 跟踪路由 : traceroute www.baidu.com

## 3,权限管理和目录应用

### 3.1 目录概述

#### linux文件目录

* /bin : 存放二进制可执行文件(ls,cat,mkdir等),常用命令都放在这
* /etc : 存放系统管理和配置文件
* /home : 存放所有用户文件的根目录, 是用户主目录的基点, 比如用户user的主目录就是/home/user, 可以用~/user表示。
* /usr : 用于存放系统应用程序, 比较重要的目录/usr/local 本地系统管理员软件安装目录 (安装系统级的应用)。这是最庞大的目录,要用到的应用程序和文件几乎都在这个目录
  * /usr/x11r6 : 存放x window的目录
  * /usr/bin : 众多的应用程序
  * /usr/sbin : 超级用户的一些管理程序
  * /usr/doc : linux文档
  * /usr/include : linux下开发和编译应用程序所需要的头文件。
  * /usr/lib : 常用的动态链接库和软件包的配置文件
  * /usr/man : 帮助文档。
  * /usr/src : 源代码,linux内核的源代码就放在/usr/src/linux里
  * /usr/local/bin : 本地增加的命令
  * /usr/local/lib : 本地增加的库
* /opt : 额外安装的可选应用程序包所放置的位置。 一般情况下, 我们可以把tomcat等都安装到这里。
* /proc : 虚拟文件系统目录, 是系统内存的映射。 可直接访问这个目录来获取系统信息。
* /root : 超级用户(系统管理员)的主目录。
* /sbin : 存放二进制可执行文件, 只有root才能访问。 这里存放的是系统管理员使用的系统级别的管理命令和程序。 如ifconfig等。
* /dev : 用于存放设备文件
* /mnt : 系统管理员安装临时文件系统的安装点, 系统提供这个目录是让用户临时挂载其他的文件系统。
* /boot : 存放用于系统引导时使用的各种文件。
* /lib : 存放文件系统中的程序运行所需要的共享库及内核模块。 共享库又叫动态链接库, 作用类似windows里的.dll文件, 存放了根文件系统程序运行所需的共享文件。
* /tmp : 用于存放各种临时文件, 是公用的临时文件存储点。
* /var : 用于存放运行时需要改变数据的文件, 也是某些大文件层溢出区, 比方说各种服务的日志文件(系统启动日志等。)等
* /lost+found : 这个目录平时是空的,系统非正常关机而留下 "无家可归" 的文件。(windows下叫什么.chk) 就在这里。

#### /etc文件目录

* /etc/rc或/etc/rc.d或etc/rc.?d : 启动,或改变运行级时运行的脚本或脚本的目录。
* /etc/passwd : 用户数据库, 其中的域给出了用户名, 真实姓名, 
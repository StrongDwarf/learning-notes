# 《应用架构演进》课程笔记

###### author:朱泽聪

###### class:后端一班

###### createTime:2019/7/6

## 目录

* [概念简介](#概念简介)
* [应用架构演进](#应用架构演进)

## 概念简介

### 术语

#### 1,集中式应用

* 1)从功能上,应用所有的功能都集中运行在一个中心节点。如程序运行在一个JVM里,数据存储在一个数据库里。
* 2)从架构上,多数用的是闭源软件,包括操作系统,数据库,存储等。
* 3)从行业上,多数为传统行业,如银行,电信,政府部门。

#### 2,分布式应用

* 1)从功能上,应用所有的功能都分散运行在网络上不同的节点上,彼此通过消息传递来通信和协调。如程序运行在多个JVM上,数据存储在多个数据库里。
* 2)从架构上,多数用的是开源软件。
* 3)从行业上,多数为互联网公司。

#### 3,IDC

IDC:Internet Data Center。

#### 4,中间件

1)从定义上,是一类软件的统称,介于应用于底层环境(操作系统,网络,数据库等)之间,提供各种服务。简化用户的操作流程,并能管理各种计算机资源。

2)从分类上,可以分为应用服务器中间件,数据访问中间件,消息中间件,交易中间件等。

* a,应用服务器中间件:如WebLogic,Tomcat,WAS。
* b,消息中间件:MQ。
* c,Web服务器中间件:IIS,IHS,nginx。

#### 5,负载均衡

是一种技术,通过一定的算法实现交易流浪的负载分配。

#### 6,F5

原本是一家公司(F5 Networks),其提供的负载均衡器(硬件)叫F5 BIG-IP,简称F5。

#### 7,硬负载VS软负载

* 硬负载:采用硬件方式来实现负载均衡。
* 软负载:采用软件方式来实现负载均衡。

#### 8,SNAT

SNAT:源地址转换,用于互不相通的地址之间进行地址转换,以便可以正常的进行网络访问。

###### 注:实现了SNAT后,http的request.getRemoteHost请求获取的客户端IP,不是真实的终端IP。

#### 9,DNS

DNS:域名系统,将域名和IP地址进行相互映射。

好处:

* 1,IDC的高可用。
* 2,IP地址修改。

#### 10,两地三中心

两地三中心:一种灾备的解决方案。

* 1)两地:同城,异地。
* 2)三中心:生产中心,同城灾备中心,异地灾备中心。

## 应用架构演进

### 集中式应用的架构演进

#### 发展初期

架构特点:

* 1:单机:应用服务器(in JVM)。
* 2:jsp,Servlet或框架(SSH)+容器(Web,EJB)。
* 3:JDBC访问数据库。
* 4:应用服务器与数据服务器分离部署。

#### 发展中期

架构特点:

* 1:应用服务器高可用。
* 2:负载均衡器，如F5。
* 3:负载均衡管理。
  * 会话管理。
  * 负载均衡策略。
    * 负载均衡算法。
    * 会话保持算法。
  * 健康检查。
  * SNAT转换。
  * 常见问题。
    * 会话&无会话场景。
* 4:Web个App逻辑部署分离。
  * WEB:静态文件如js,css,图片。
  * App:除静态文件以外的应用程序。
* 5:数据库主备。

#### 发展后期

架构特点:

* 1:Web和APP物体部署分离:可能多个Web对一个APP。
* 2:数据库高可用:读写分离,物理部署分离。
* 3:应用:读，写交易的区分。
* 4:数据同步。
* 5:数据缓存。
* 6:使用搜索引擎。
* 7:应用缓存。

### 分布式应用

架构特点:

* 1:应用功能分离(not in JVM)。
* 2:服务化:生产者,消费者。
* 3:公共基础设施:注册中心,缓存中心。
* 4:数据库:分布式数据库。
* 5:容器化管理。

### 多IDC

#### 同城高可用

架构特点:

* 1:多IDC部署:同城高可用。
* 2:客户端:DNS解析(解析结果固定)。
* 3:服务器:DNS解析,避免跨IDC访问。
* 4:数据库:单活,主备模式,单向同步。
* 5:应用:访问主库。

#### 异地双活

架构特点:

* 1:多IDC部署:异地双活。
* 2:数据库:双活,双向同步(应用实现)。
* 3:应用:读多写少,无状态,数据阻塞的及时监控和处理。
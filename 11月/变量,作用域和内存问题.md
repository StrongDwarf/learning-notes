# 变量,作用域和内存问题
&nbsp;按照ECMA-262的定义,JavaScript的变量与其他语言的变量有很大区别。JavaScript变量松散类型的本质,决定了它只是在特定时间用于保存特定值的一个名字而已。由于不存在定义某个变量必须要保存何种数据类型的规则,变量的值及其数据类型可以在脚本的生命周期内改变。尽管从某种角度看,这可能是一个即有趣又强大,同时又容易出问题的特性，但JavaScript变量实际的复杂程度还远不止如此。
## 1 基本类型和引用类型的值
基本类型值指的是简单的数据段,而引用类型值指那些可能由多个值构成的对象。
操作基本类型值的时候,操作的是保存在变量中的实际的值。操作引用类型值的时候,实际上是在操作对象的引用而不是实际的对象。为此,引用类型的值是按引用访问的。基于此，当向函数传递基本类型值的时候，传递的是基本类型值的复制,而传递引用数据类型值的时候，传递的是值的引用。这种情况造成的区别就是在函数内部执行对引用类型值的操作会改变原来的值，而执行对基本类型值的操作时则不会改变原来的值，具体例子如下:
```
var a = 1;
var b = {
   name:1
}
function aFunc(a){
   a  ;
}
function bFunc(b){
   b.name  ;
}
aFunc(a);
bFunc(b);
console.log(a);   //2
console.log(b.name)   //2
```
### 1.1 动态的属性
定义基本类型值和引用类型值的方式是类似的:创建一个变量并为该变量赋值。但是当这个值保存到变量中后,对不同类型值可以执行的操作则大相径庭。对于引用类型的值，我们可以为其添加属性和方法,也可以改变和删除其属性和方法。
### 1.2 复制变量值
除了保存的方式不同之外，在从一个变量向另一个变量复制基本类型值和引用类型值时，也存在不同。如果从一个变量向另一个变量复制基本类型的值，会在变量对象上创建一个新值，然后把该值复制到为新变量分配的位置上。
而当复制一个引用类型变量的值时，复制的只是该对像的指针。因此，改变其中一个变量，就会影响另一个变量。
### 1.3 传递参数
ECMAScript中所有函数的参数都是按值传递的。也就是说,把函数外部的值复制给函数内部的参数，就和把值从一个变量复制到另一个变量一样。
### 1.4 检测类型
要检测一个变量是不是基本数据类型可以使用typeof检测，而要检测一个引用类型的变量是什么数据类型,则可以使用instanceOf
## 2 执行环境及作用域
执行环境是JavaScript中最为重要的一个概念。执行环境定义了变量或函数有权访问的其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的变量对象(variable object),环境中定义的所有变量和函数都保存在这个对象中。虽然我们编写的代码无法访问这个对象，但解析器在处理数据时会在后台使用它。
全局执行环境舒适最外围的一个执行环境。根据ECMAScript实现所在的宿主环境不同，表示执行环境的对象也不一样。在Web浏览器·中，全局执行环境被认为是window对象，因此所有全局变量和函数都是作为window对象的属性和方法创建的。某个执行环境中的所有代码执行完毕后，该环境被销毁，保存在其中的所有变量和函数定义也随之销毁(全局执行环境直到应用程序退出--例如关闭网页或浏览器--时才会被销毁)。
每个函数都有自己的执行环境。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。ECMAScript程序中的执行流正是由在个方便的机制控制着。
当代码在一个环境中执行时，会创建变量对象的一个作用域链。作用域链的用途，是保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的前端，始终都是当前执行的代码所在环境的变量对象。如果在个环境是函数，则将其活动对象作为变量对象。活动对象在最开始时只包含一个变量，即arguments对象(这个对象在全局环境中是不存在的)。作用域链中的下一个变量对象来自包含(外部)环境，而再下一个变量对象则来自下一个包含环境。这样，一直延续到全局执行环境，全局执行环境的变量对象始终都是作用域链中的最后一个对象。
标志符解析是沿着作用域链一级一级地搜索标标识符的过程。搜索过程始终从作用域链的前端开始，然后逐级地向后回溯，直至找到标志符为止(如果找不到标识符，通常会有错误发生)。
### 2.1 延长作用域链
虽然执行环境的类型总共有两种-全局和局部(函数),但还是有其他办法来延长作用域链。这么说是因为有些语句可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。在两种情况下会发生这种现象。
* try-catch语句的catch块
* with语句
这两个语句都会在作用域的前端添加一个变量对象。对with语句来说，会将指定的对象添加到作用域链中。对catch语句来说，会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明。
而对于with语句来说，其是将一个对象添加到作用域的前端。
如下所示的代码
```
function buildUrl(){
   var qs = "?debug=true";
   with(location){
      var url = href   qs;
   }
   return url;
}
```
此时，with语句接收location对象，并将其添加到前端。
